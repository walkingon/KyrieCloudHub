# 技术架构

## 1. 编程语言和框架

| 技术 | 版本/说明 |
|------|----------|
| **Dart** | SDK ^3.10.1 |
| **Flutter** | 跨平台UI框架 |
| **目标平台** | Windows、Android、Linux、iOS、macOS、Web |

## 2. 项目目录结构

```
kyrie_cloud_hub/
├── lib/                          # 核心代码
│   ├── main.dart                # 应用入口
│   ├── models/                  # 数据模型层
│   │   ├── platform_type.dart
│   │   ├── platform_credential.dart
│   │   ├── bucket.dart
│   │   ├── object_file.dart
│   │   └── transfer_task.dart
│   ├── screens/                 # UI页面层
│   │   ├── main_screen.dart
│   │   ├── bucket_objects_screen.dart    # 对象浏览器
│   │   ├── platform_selection_screen.dart
│   │   ├── login_dialog.dart
│   │   ├── transfer_queue_screen.dart
│   │   ├── settings_screen.dart
│   │   ├── about_screen.dart
│   │   └── widgets/             # 页面组件（从 bucket_objects_screen 拆分）
│   │       ├── export.dart              # 统一导出
│   │       ├── path_navigation.dart     # 路径导航组件
│   │       ├── status_widgets.dart      # 状态组件（加载/错误）
│   │       ├── pagination_controls.dart # 分页控制器
│   │       ├── object_list_item.dart    # 列表项组件
│   │       ├── object_grid_item.dart    # 网格项组件
│   │       ├── object_dialogs.dart      # 对话框组件
│   │       └── batch_operations.dart    # 批量操作逻辑
│   ├── services/                # 业务服务层
│   │   ├── api/                # 云平台API适配器
│   │   │   ├── cloud_platform_api.dart    # 接口抽象
│   │   │   ├── tencent_cos_api.dart       # 腾讯云COS实现
│   │   │   ├── aliyun_oss_api.dart        # 阿里云OSS实现
│   │   │   ├── tencent/                   # 腾讯云模块
│   │   │   │   ├── tencent_signature_generator.dart      # 签名生成器
│   │   │   │   ├── tencent_multipart_upload_manager.dart # 分片上传管理器
│   │   │   │   └── tencent_multipart_download_manager.dart # 分块下载管理器
│   │   │   └── aliyun/                    # 阿里云模块
│   │   │       ├── aliyun_signature_generator.dart     # 签名生成器
│   │   │       ├── aliyun_multipart_upload_manager.dart  # 分片上传管理器
│   │   │       └── aliyun_multipart_download_manager.dart # 分块下载管理器
│   │   ├── cloud_platform_factory.dart   # 工厂模式创建API
│   │   ├── storage_service.dart
│   │   └── transfer_queue_service.dart
│   ├── widgets/                 # 公共组件
│   └── utils/                   # 工具类
│       ├── logger.dart
│       ├── file_type_helper.dart          # 文件类型辅助工具
│       ├── file_chunk_reader.dart         # 文件分块读取器
│       └── progress_dialog.dart           # 通用进度对话框
├── android/                     # Android原生配置
├── ios/                         # iOS原生配置
├── windows/                     # Windows原生配置
├── linux/                       # Linux原生配置
├── macos/                       # macOS原生配置
├── web/                         # Web配置
├── pubspec.yaml                 # 依赖配置
└── 技术架构.md                   # 技术架构文档
```

## 3. 核心依赖和技术栈

| 依赖 | 用途 |
|-----|------|
| **dio ^5.4.0** | HTTP客户端，网络请求 |
| **provider ^6.1.1** | 状态管理 |
| **shared_preferences ^2.2.2** | 本地持久化存储 |
| **path_provider ^2.1.2** | 获取系统路径 |
| **file_picker ^8.0.0** | 文件选择器 |
| **crypto ^3.0.3** | 加密哈希 |
| **intl ^0.19.0** | 国际化/日期格式化 |
| **url_launcher ^6.2.5** | 打开外部链接 |
| **xml ^6.5.0** | XML解析 |
| **cupertino_icons ^1.0.8** | iOS风格图标 |

## 4. 架构模式

采用分层架构 + 工厂模式 + 策略模式：

```
┌─────────────────────────────────────────────────────────┐
│                    UI层 (Screens)                       │
│         main_screen, bucket_objects_screen, etc.        │
└─────────────────────┬───────────────────────────────────┘
                      │ Provider状态管理
                      ▼
┌─────────────────────────────────────────────────────────┐
│                   服务层 (Services)                     │
│  storage_service, transfer_queue_service                │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                API适配器层 (Factory Pattern)            │
│         CloudPlatformFactory.createApi()                │
└─────────────────────┬───────────────────────────────────┘
          ┌───────────┴───────────┐
          ▼                       ▼
┌─────────────────┐    ┌─────────────────────┐
│ TencentCosApi   │    │ AliyunOssApi        │
│ (策略实现)       │    │ (策略实现)           │
│ ├─签名生成器     │    │ ├─签名生成器         │
│ ├─分片上传       │    │ ├─分片上传           │
│ └─分块下载       │    │ ├─分块下载           │
└─────────────────┘    └─────────────────────┘
          ▲                       ▲
          └─────────┬─────────────┘
                    │ 实现 ICloudPlatformApi 接口
```

## 5. 核心功能模块

| 模块 | 功能 |
|-----|------|
| **账号管理** | SecretID/SecretKey登录凭证管理 |
| **存储桶管理** | 查询、浏览存储桶 |
| **对象存储** | 文件上传(支持分片)、下载(支持分块)、删除 |
| **传输队列** | 任务队列管理，进度追踪 |
| **本地存储** | 凭证持久化存储 |
