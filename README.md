# KyrieCloudHub

## 应用概述

KyrieCloudHub是一款使用Flutter技术开发的，跨平台（Windows、Android、Linux等）支持多种云服务厂商（腾讯云、阿里云等）对象存储服务的聚合网盘服务客户端，该应用旨在为用户提供一种拥有独立控制权限的私有云盘服务。

## 核心功能

*说明：因各家云服务厂商对同一种服务的产品命名不同，如腾讯云中的对象存储COS与阿里云中的OSS，我们后文均以腾讯云产品及概念为例。*

### 1.账号登录

登录平台账号获取安全凭证是一切云盘文件操作的前提，当前应用提供以访问密钥（SecretID + SecretKey）的方式进行平台登录。密钥需要用户在官方开发平台自行创建获取。

应用目前支持登录的平台有：腾讯云、阿里云

### 2.查看存储桶列表

存储桶是文件存储的容器和载体，用户登录平台账号后，自动查询并列出存储桶列表。（出于文件安全考虑，应用不提供存储桶的创建和删除功能，用户在平台自行创建管理存储桶）

### 3.存储桶内文件管理

- 查看存储桶内文件列表

- 文件（批量）的下载

- 文件（批量）的删除

- 文件（批量）的上传

## 用户界面交互流程

### 1.主界面

主界面左侧为抽屉栏，子菜单依次为“平台切换”、“传输队列”、“设置”、“关于”。顶部AppBar水平居中显示为当前使用的平台名称，如“腾讯云”、“阿里云”或空内容（未选择平台时）

- 当用户为新用户，即应用本地没有查询到用户上一次登录的平台记录时，顶部AppBar显示空标题，界面中心显示一个“去选择平台”按钮，点击后进入平台选择界面。

- 当应用本地有用户上一次登录记录时，顶部AppBar显示平台名称，主界面列出查询到的存储桶列表。

*说明：登录概念只是方便用户理解。因该应用的功能是基于云厂商平台提供的无状态的HTTP请求API，并不存在实际的登录协议，应用内部对登录动作的处理实际上只做登录信息的本地存储*

### 2.左侧抽屉栏

用户点击左侧抽屉栏，展开子菜单“平台切换”、“传输队列”、“设置”、“关于”。

- 选择“平台切换”，进入平台选择界面

    - 平台选择界面列出可供选择的平台选项：“腾讯云”、“阿里云”。选项需显示登录状态（即是否有上一次登录成功的记录）。如对于有上一次登录成功记录的选项，选项中显示一个绿色对号的状态图标。对于有绿色对号状态的选项，选项后额外提供一个“登出”的按钮，点击该登出按钮后清理登录记录并刷新选项显示状态。
    - 当用户点击选择的平台选项为未登录状态（即用户从未使用该平台选项登录成功过），则弹出登录对话框。

        - 登录对话框显示需要输入的登录信息有：SecretID、SecretKey。用户输入全部信息后可点击“登录”按钮进行登录，或关闭该对话框以取消登录。
        - 用户点击登录后，应用返回主界面，刷新界面显示AppBar标题，并使用记录的登录信息查询存储桶列表，若查询成功则将该登录密钥记为登录成功，并刷新存储桶列表显示。
        - 若查询存储桶列表数据失败，给出界面提示错误原因，根据响应状态码判断若是密钥有误，则清理记录的登录密钥。

    - 当用户点击选择的平台选项有上一次登录成功记录，则直接使用上一次登录密钥进行登录，并返回主界面刷新相关内容显示。

- 选择“传输队列”，进入传输队列界面

    - 传输队列界面传输任务相关信息，分为“进行中”和“已完成”两个标签页。
    - “进行中”标签页
        - 显示当前上传或下载的对象文件列表，列表中元素需显示文件名、上传中/下载中、进度条
    - “已完成”标签页
        - 显示已传输完成的文件名列表

- 选择“设置”，进入设置界面

    - 暂时无内容显示

- 选择“关于”，进入关于界面

    - 显示内容
        - 应用图标（暂时用临时图片占位）
        - Copyright [2025] [walkingon]
        - GitHub链接地址（点击后可使用外部浏览器打开）：https://github.com/walkingon/KyrieCloudHub

### 3.主界面列表视图

主界面列表视图是主界面内的主体内容，其以资源文件浏览器的形式显示存储桶列表或资源列表，支持“列表”和“网格”两种视图模式切换。

- 列表视图上方显示为当前文件路径，路径左侧为返回上一级按钮，路径右侧为视图切换滑动块。
- 列表右下方显示页码信息以及前后翻页的按钮。
- 当列表内容显示为存储桶列表时

    - 路径显示为根路径“/”
    - 点击存储桶列表可进入存储桶内对象文件列表。

- 当列表内容显示为对象文件列表时

    - 路径显示为当前“目录”路径
    - 目录路径后显示加号按钮

        - 点击该加号，显示选项“上传文件”、“新建文件夹”

            - 当用户选择上传文件

               - 弹出操作系统的文件选择器，支持用户选择多个文件批量上传
               - 文件上传到存储桶的当前路径

            - 当用户选择“新建文件夹”

               - 需要用户输入文件夹名称，点击创建文件

    - 对象文件显示形式为图标、文件名（含扩展名）、创建时间
    - 点击对象图标或名称，显示该对象文件的可操作选项
        
        - 下载：进行该文件的下载
        - 删除：删除该对象文件

---

## 技术架构

### 1. 编程语言和框架

| 技术 | 版本/说明 |
|------|----------|
| **Dart** | SDK ^3.10.1 |
| **Flutter** | 跨平台UI框架 |
| **目标平台** | Windows、Android、Linux、iOS、macOS、Web |

### 2. 项目目录结构

```
kyrie_cloud_hub/
├── lib/                          # 核心代码
│   ├── main.dart                # 应用入口
│   ├── models/                  # 数据模型层
│   │   ├── platform_type.dart
│   │   ├── platform_credential.dart
│   │   ├── bucket.dart
│   │   ├── object_file.dart
│   │   └── transfer_task.dart
│   ├── screens/                 # UI页面层
│   │   ├── main_screen.dart
│   │   ├── bucket_objects_screen.dart
│   │   ├── platform_selection_screen.dart
│   │   ├── login_dialog.dart
│   │   ├── transfer_queue_screen.dart
│   │   ├── settings_screen.dart
│   │   └── about_screen.dart
│   ├── services/                # 业务服务层
│   │   ├── api/                # 云平台API适配器
│   │   │   ├── cloud_platform_api.dart  # 接口抽象
│   │   │   ├── tencent_cos_api.dart     # 腾讯云COS实现
│   │   │   └── ali_yun_oss_api.dart     # 阿里云OSS实现
│   │   ├── cloud_platform_factory.dart  # 工厂模式创建API
│   │   ├── storage_service.dart
│   │   ├── transfer_queue_service.dart
│   │   └── multipart_upload/    # 分片上传模块
│   │       ├── multipart_upload_manager.dart
│   │       └── file_chunk_reader.dart
│   ├── widgets/                 # 公共组件
│   └── utils/                   # 工具类
│       └── logger.dart
├── android/                     # Android原生配置
├── ios/                         # iOS原生配置
├── windows/                     # Windows原生配置
├── linux/                       # Linux原生配置
├── macos/                       # macOS原生配置
├── web/                         # Web配置
├── pubspec.yaml                 # 依赖配置
└── 系统设计.md                   # 系统设计文档
```

### 3. 核心依赖和技术栈

| 依赖 | 用途 |
|-----|------|
| **dio ^5.4.0** | HTTP客户端，网络请求 |
| **provider ^6.1.1** | 状态管理 |
| **shared_preferences ^2.2.2** | 本地持久化存储 |
| **path_provider ^2.1.2** | 获取系统路径 |
| **file_picker ^8.0.0** | 文件选择器 |
| **crypto ^3.0.3** | 加密哈希 |
| **intl ^0.19.0** | 国际化/日期格式化 |
| **url_launcher ^6.2.5** | 打开外部链接 |
| **xml ^6.5.0** | XML解析 |
| **cupertino_icons ^1.0.8** | iOS风格图标 |

### 4. 架构模式

采用分层架构 + 工厂模式 + 策略模式：

```
┌─────────────────────────────────────────────────────────┐
│                    UI层 (Screens)                       │
│         main_screen, bucket_objects_screen, etc.        │
└─────────────────────┬───────────────────────────────────┘
                      │ Provider状态管理
                      ▼
┌─────────────────────────────────────────────────────────┐
│                   服务层 (Services)                     │
│  storage_service, transfer_queue_service                │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│                API适配器层 (Factory Pattern)            │
│         CloudPlatformFactory.createApi()                │
└─────────────────────┬───────────────────────────────────┘
          ┌───────────┴───────────┐
          ▼                       ▼
┌─────────────────┐    ┌─────────────────────┐
│ TencentCosApi   │    │ AliyunOssApi        │
│ (策略实现)       │    │ (策略实现)           │
└─────────────────┘    └─────────────────────┘
          ▲                       ▲
          └─────────┬─────────────┘
                    │ 实现 ICloudPlatformApi 接口
```

### 5. 核心功能模块

| 模块 | 功能 |
|-----|------|
| **账号管理** | SecretID/SecretKey登录凭证管理 |
| **存储桶管理** | 查询、浏览存储桶 |
| **对象存储** | 文件上传(支持分片)、下载、删除 |
| **传输队列** | 任务队列管理，进度追踪 |
| **本地存储** | 凭证持久化存储 |

## 开发计划

- [ ] 文件（夹）移动到
- [ ] 文件（夹）复制到